tinymce.PluginManager.add('anchor', function(editor) {
  function showDialog() {
    const selectionNode = editor.selection.getNode();
    let anchorName = '';

    if (selectionNode.tagName === 'A' && !selectionNode.href) {
      anchorName = selectionNode.name || selectionNode.id || '';
    }

    editor.windowManager.open({
      title: 'Anchor',
      body: {
        type: 'textbox',
        name: 'name',
        size: 40,
        label: 'Name',
        value: anchorName
      },
      onsubmit: function(data) {
        const anchorName = data.data.name;

        if (selectionNode.tagName === 'A' && selectionNode.href) {
          selectionNode.id = anchorName;
        } else {
          editor.selection.collapse(!0);
          const anchorHtml = editor.dom.createHTML('a', { id: anchorName });
          editor.execCommand('mceInsertContent', !1, anchorHtml);
        }
      }
    });
  }

  editor.addCommand('mceAnchor', showDialog);
  editor.addButton('anchor', {
    icon: 'anchor',
    tooltip: 'Insert/edit anchor',
    onAction: showDialog
  });
});
