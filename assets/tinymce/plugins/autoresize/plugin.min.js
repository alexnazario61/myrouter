tinymce.PluginManager.add('autoresize', function (editor) {
  function isFullscreen() {
    return editor.plugins.fullscreen && editor.plugins.fullscreen.isFullscreen();
  }

  function calculateHeight(resizeMode) {
    var doc = editor.getDoc();
    if (!doc || (resizeMode && 'setcontent' === resizeMode.type && resizeMode.initial) || isFullscreen()) {
      return;
    }

    var body = doc.body,
      documentElement = doc.documentElement,
      marginTop = editor.dom.getStyle(body, 'margin-top', true),
      marginBottom = editor.dom.getStyle(body, 'margin-bottom', true),
      paddingTop = editor.dom.getStyle(body, 'padding-top', true),
      paddingBottom = editor.dom.getStyle(body, 'padding-bottom', true),
      borderTopWidth = editor.dom.getStyle(body, 'border-top-width', true),
      borderBottomWidth = editor.dom.getStyle(body, 'border-bottom-width', true);

    var currentHeight = body.offsetHeight +
      parseInt(marginTop, 10) +
      parseInt(marginBottom, 10) +
      parseInt(paddingTop, 10) +
      parseInt(paddingBottom, 10) +
      parseInt(borderTopWidth, 10) +
      parseInt(borderBottomWidth, 10);

    if (isNaN(currentHeight) || 0 >= currentHeight) {
      currentHeight = tinymce.Env.ie ? body.scrollHeight : (tinymce.Env.webkit && 0 === body.clientHeight ? 0 : body.offsetHeight);
    }

    var minHeight = editor.settings.autoresize_min_height = parseInt(editor.getParam('autoresize_min_height', body.offsetHeight), 10),
      maxHeight = editor.settings.autoresize_max_height = parseInt(editor.getParam('autoresize_max_height', 0), 10);

    if (currentHeight > minHeight) {
      minHeight = currentHeight;
    }

    if (maxHeight && currentHeight > maxHeight) {
      minHeight = maxHeight;
      body.style.overflowY = 'auto';
      documentElement.style.overflowY = 'auto';
    } else {
      body.style.overflowY = 'hidden';
      documentElement.style.overflowY = 'hidden';
      body.scrollTop = 0;
    }

    if (minHeight !== previousHeight) {
      var dom = tinymce.DOM;
      dom.setStyle(editor.iframeElement, 'height', minHeight + 'px');
      previousHeight = minHeight;
      if (tinymce.isWebKit && 0 > minHeight - previousHeight && calculateHeight(resizeMode)) {
        // eslint-disable-next-line no-use-before-define
        recursiveResize(20, 100, function () {
          recursiveResize(5
