!function(){ // Immediately Invoked Function Expression (IIFE)

  // Create a new TinyMCE plugin named BBCodePlugin
  tinymce.create("tinymce.plugins.BBCodePlugin",{
    init:function(e){ // Initialization function
      var t=this,
          n=e.getParam("bbcode_dialect","punbb").toLowerCase(); // Get the BBCode dialect from the settings

      // Before the content is set, convert BBCode to HTML
      e.on("beforeSetContent",function(e){
        e.content=t["_"+n+"_bbcode2html"](e.content)
      });

      // After the content is processed, convert HTML back to BBCode
      e.on("postProcess",function(e){
        e.set&&(e.content=t["_"+n+"_bbcode2html"](e.content)),
        e.get&&(e.content=t["_"+n+"_html2bbcode"](e.content))
      })
    },

    // Plugin information
    getInfo:function(){
      return{
        longname:"BBCode Plugin",
        author:"Ephox Corp",
        authorurl:"http://www.tinymce.com",
        infourl:"http://www.tinymce.com/wiki.php/Plugin:bbcode"
      }
    },

    // Conversion functions
    _punbb_html2bbcode:function(e){ // HTML to BBCode conversion for 'punbb' dialect
      // ... various regular expression replacements ...
    },

    _punbb_bbcode2html:function(e){ // BBCode to HTML conversion for 'punbb' dialect
      // ... various regular expression replacements ...
    }
  });

  // Add the plugin to TinyMCE's PluginManager
  tinymce.PluginManager.add("bbcode",tinymce.plugins.BBCodePlugin)

}(); // End of IIFE
