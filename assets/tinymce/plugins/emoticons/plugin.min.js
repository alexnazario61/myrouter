// Adds a new plugin called "emoticons" to TinyMCE's PluginManager
tinymce.PluginManager.add("emoticons", function(editor, url) {

  // An array of arrays, where each sub-array contains a list of emoticons
  var emoticonsList = [
    ["cool", "cry", "embarassed", "foot-in-mouth"],
    ["frown", "innocent", "kiss", "laughing"],
    ["money-mouth", "sealed", "smile", "surprised"],
    ["tongue-out", "undecided", "wink", "yell"]
  ];

  // Creates a new button in the toolbar called "emoticons"
  editor.addButton("emoticons", {
    type: "panelbutton",
    panel: {
      role: "application", // The panel has an application role
      autohide: true, // The panel will automatically hide
      html: createEmoticonsPanelHTML(), // The panel's HTML content
      // Callback function when the panel's content is clicked
      onclick: function(event) {
        var linkElement = editor.dom.getParent(event.target, "a");
        if (linkElement) {
          // Inserts the selected emoticon into the editor
          editor.insertContent('<img src="' + linkElement.getAttribute("data-mce-url") + '" alt="' + linkElement.getAttribute("data-mce-alt") + '" />');
          // Hides the panel
          this.hide();
        }
      }
    },
    tooltip: "Emoticons" // The tooltip text for the button
  });

  // Creates the HTML content for the "emoticons" panel
  function createEmoticonsPanelHTML() {
    var tableHTML = '<table role="list" class="mce-grid">';
    tinymce.each(emoticonsList, function(emoticonsRow) {
      tableHTML += "<tr>";
      tinymce.each(emoticonsRow, function(emoticon
