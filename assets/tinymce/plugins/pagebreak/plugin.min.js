// Add a new plugin called "pagebreak" to TinyMCE
tinymce.PluginManager.add("pagebreak", function(editor) {
  
  // Define the separator string for the page break, with a default value of "<!-- pagebreak -->"
  var separator = editor.getParam("pagebreak_separator", "<!-- pagebreak -->");
  
  // Create a regular expression from the separator string
  var separatorRegex = new RegExp(separator.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g, function(char) {
    return "\\" + char;
  }), "gi");
  
  // Define the page break image as an HTML string
  var pageBreakImg = '<img src="' + tinymce.Env.transparentSrc + '" class="mce-pagebreak" data-mce-resize="false" data-mce-placeholder />';
  
  // Define the "mcePageBreak" command
  editor.addCommand("mcePageBreak", function() {
    // If the "pagebreak\_split\_block" option is enabled, insert the page break image inside a new paragraph
    if (editor.settings.pagebreak_split_block) {
      editor.insertContent("<p>" + pageBreakImg + "</p>");
    } else {
      // Otherwise, just insert the page break image
      editor.insertContent(pageBreakImg);
    }
  });
  
  // Add a new button to the editor toolbar for the "mcePageBreak" command
  editor.addButton("pagebreak", {
    title: "Page break",
    cmd: "mcePageBreak"
  });
  
  // Add a new menu item to the editor context menu for the "mcePageBreak" command
  editor.addMenuItem("pagebreak", {
    text: "Page break",
    icon: "pagebreak",
    cmd: "mcePageBreak",
    context: "insert"
  });
  
  // When resolving the name of a node, check if it's a page break image and set its name to "pagebreak"
 
